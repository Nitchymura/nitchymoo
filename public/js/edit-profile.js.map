{"version":3,"names":[],"mappings":"","sources":["edit-profile.js"],"sourcesContent":["//edit-profile.js\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n    const avatarInput = document.getElementById('avatar');\r\n    const preview = document.getElementById('avatar-preview');\r\n    const userIcon = document.getElementById('user-icon');\r\n    const deleteBtn = document.getElementById('delete-avatar');\r\n    const avatarDeleted = document.getElementById('avatar-deleted');\r\n\r\n    // --- 初期状態でアイコンを正しく表示/非表示 ---\r\n    if (!preview.src || preview.src.trim() === '') {\r\n        preview.style.display = 'none';\r\n        if (userIcon) userIcon.classList.remove('d-none');\r\n    } else {\r\n        preview.style.display = 'block';\r\n        if (userIcon) userIcon.classList.add('d-none');\r\n    }\r\n\r\n    // --- ファイル選択時 ---\r\n    avatarInput.addEventListener('change', function(event) {\r\n        const file = event.target.files[0];\r\n\r\n        if (!file) {\r\n            // ファイル選択解除時\r\n            if (preview.dataset.original) {\r\n                preview.src = preview.dataset.original;\r\n                preview.style.display = 'block';\r\n                if (userIcon) userIcon.classList.add('d-none');\r\n                if (deleteBtn) deleteBtn.style.display = 'inline-block';\r\n                avatarDeleted.value = 'false';\r\n            } else {\r\n                preview.style.display = 'none';\r\n                if (userIcon) userIcon.classList.remove('d-none');\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (!file.type.startsWith(\"image/\")) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = function(e) {\r\n            preview.src = e.target.result;\r\n            preview.style.display = 'block';\r\n            if (userIcon) userIcon.classList.add('d-none');\r\n            avatarDeleted.value = 'false';\r\n            if (deleteBtn) deleteBtn.style.display = 'none';\r\n        };\r\n        reader.readAsDataURL(file);\r\n    });\r\n\r\n    // --- 削除ボタン ---\r\n    if (deleteBtn) {\r\n        deleteBtn.addEventListener('click', function () {\r\n            fetch(\"/profile/avatar\", {    \r\n                method: \"DELETE\",\r\n                headers: {\r\n                    \"X-CSRF-TOKEN\": document.querySelector('meta[name=\"csrf-token\"]').getAttribute(\"content\"),\r\n                    \"Accept\": \"application/json\"\r\n                }\r\n            })\r\n            .then(response => {\r\n                if (response.ok) {\r\n                    preview.src = '';\r\n                    preview.style.display = 'none';\r\n                    if (userIcon) userIcon.classList.remove('d-none');\r\n                    avatarDeleted.value = 'true';\r\n                    deleteBtn.style.display = 'none';\r\n                    avatarInput.value = '';\r\n                } else {\r\n                    alert('削除に失敗しました');\r\n                }\r\n            })\r\n            .catch(() => alert('通信エラーが発生しました'));\r\n        });\r\n    }\r\n});"],"file":"edit-profile.js"}